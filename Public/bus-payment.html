<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bus Payment - TripJoy Ride</title>
  <link rel="stylesheet" href="styles.css"/>
  <script defer src="script.js"></script>
</head>
<body>

<nav class="navbar">
  <h2 class="logo"><img src="logo.jpg" alt="RideBooking Logo"></h2>
  <ul>
    <li><a href="index.html#home">Home</a></li>
    <li><a href="index.html#about">About Us</a></li>
    <li><a href="index.html#help">Help</a></li>
    <li><button class="login-btn" onclick="openLoginModal()">Login</button></li>
  </ul>
</nav>

<div class="container">
  <div class="summary">
    <h2>Payment Summary</h2>
    <p><strong>Bus:</strong> <span id="ride-name"></span></p>
    <p><strong>Date:</strong> <span id="journey-date"></span></p>
    <p><strong>From:</strong> <span id="from-station"></span></p>
    <p><strong>To:</strong> <span id="to-station"></span></p>
    <p><strong>Passengers:</strong> <span id="passenger-count"></span></p>
    <p><strong>Bus Operator:</strong> <span id="bus-operator"></span></p>
    <p><strong>Bus Type:</strong> <span id="bus-type"></span></p>
    <p><strong>Fare per Passenger:</strong> ₹<span id="fare-per-passenger-bus"></span></p>
    <div class="total">Total Fare: ₹<span id="total-fare"></span></div>
  </div>

  <div class="payment-form">
    <h2>Choose Payment Method</h2>
    <div class="payment-toggle">
      <button type="button" onclick="showCard()">Card</button>
      <button type="button" onclick="showUPI()">UPI</button>
    </div>

    <!-- Card Payment -->
    <form id="paymentForm" style="display: block;">
      <label for="name">Name on Card</label>
      <input type="text" id="name" required>
      <label for="cardNumber">Card Number</label>
      <input type="text" id="cardNumber" maxlength="16" required>
      <label for="expiryMonth">Expiry Date</label>
      <div class="expiry-fields">
        <select id="expiryMonth" required>
          <option value="">MM</option><option>01</option><option>02</option><option>03</option><option>04</option><option>05</option><option>06</option><option>07</option><option>08</option><option>09</option><option>10</option><option>11</option><option>12</option>
        </select>
        <select id="expiryYear" required>
          <option value="">YY</option><option>25</option><option>26</option><option>27</option><option>28</option>
        </select>
      </div>
      <label for="cvv">CVV</label>
      <input type="text" id="cvv" maxlength="3" required>
      <button type="submit">Pay ₹<span id="pay-amount"></span></button>
    </form>

    <!-- UPI Payment -->
    <form id="upiForm" style="display: none;">
      <label>Enter UPI ID</label><br><br>
      <input type="text" id="upiId" placeholder="example@upi" required>
      <button type="submit">Pay ₹<span id="upi-amount"></span> via UPI</button>
    </form>

  </div>
</div>

<script>
  // Toggle between card and upi
  function showCard() {
    document.getElementById('paymentForm').style.display = 'block';
    document.getElementById('upiForm').style.display = 'none';
  }

  function showUPI() {
    document.getElementById('paymentForm').style.display = 'none';
    document.getElementById('upiForm').style.display = 'block';
  }

  // Bus info from localStorage
  const selectedRide = JSON.parse(localStorage.getItem('selectedBus'));
  const passengerCount = parseInt(localStorage.getItem('seatsBooked') || 1);
  const journeyDate = localStorage.getItem('journeyDate');
  const passengerName = localStorage.getItem('passengerName') || 'Passenger';

  const fare = selectedRide.fare || 0;
  const totalFare = fare * passengerCount;

  document.getElementById('ride-name').innerText = `${selectedRide.operator} - ${selectedRide.busNumber}`;
  document.getElementById('journey-date').innerText = new Date(journeyDate).toDateString();
  document.getElementById('from-station').innerText = selectedRide.from;
  document.getElementById('to-station').innerText = selectedRide.to;
  document.getElementById('passenger-count').innerText = passengerCount;
  document.getElementById('bus-operator').innerText = selectedRide.operator;
  document.getElementById('bus-type').innerText = selectedRide.type || 'Standard';
  document.getElementById('fare-per-passenger-bus').innerText = fare;
  document.getElementById('total-fare').innerText = totalFare;
  document.getElementById('pay-amount').innerText = totalFare;
  document.getElementById('upi-amount').innerText = totalFare;

  // On payment success (card)
  document.getElementById('paymentForm').addEventListener('submit', (e) => {
    e.preventDefault();
    alert(`✅ Payment Successful!\n\nThank you, ${passengerName}.`);
    window.location.href = "bus-eticket.html";
  });

  // On payment success (upi)
  document.getElementById('upiForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const upiId = document.getElementById('upiId').value;
    if (!upiId.includes('@')) {
      alert("❌ Invalid UPI ID.");
      return;
    }
    alert(`✅ UPI Payment Successful via ${upiId}!\n\nThank you, ${passengerName}.`);
    window.location.href = "bus-eticket.html";
  });
</script>

</body>
</html>